@page "/admin-dashboard"

@using MobimentiNewVersion.Business.Abstract
@using MobimentiNewVersion.Components.Layout
@using MobimentiNewVersion.Entity.Concrete

@inject IMentorService _mentorService
@inject DialogService DialogService
@inject NotificationService NotificationService

<RadzenLayout Style="grid-template-areas: 'rz-sidebar rz-header' 'rz-sidebar rz-body'">
	<AdminDashboardSidebarLayout />
	<RadzenBody>
		<RadzenStack>
			<RadzenStack><RadzenText TextStyle="TextStyle.DisplayH4">Hoşgeldin Yönetici</RadzenText></RadzenStack>

			@* User Cards *@
			<RadzenStack>
				<RadzenCardGroup Responsive="true" >
				@* User Cards/Randevu Oluştur *@
				<RadzenCard Variant="Variant.Filled" Style="display:flex; align-items:center; gap:10px;">
					<RadzenColumn><RadzenImage Path="icons/mentoring.png" Style="width:50px" /></RadzenColumn>
					<RadzenColumn>
						<RadzenRow>
							<RadzenText TextStyle="TextStyle.Subtitle1">Toplam Mentor</RadzenText>
						</RadzenRow>
						<RadzenRow>
							<RadzenText TextStyle="TextStyle.H5">0</RadzenText>
						</RadzenRow>
					</RadzenColumn>
				</RadzenCard>
				<RadzenCard Variant="Variant.Filled" Style="display:flex; align-items:center; gap:10px;">
					<RadzenColumn><RadzenImage Path="icons/user.png" Style="width:50px" /></RadzenColumn>
					<RadzenColumn>
						<RadzenRow>
							<RadzenText TextStyle="TextStyle.Subtitle1">Toplam Kullanıcı</RadzenText>
						</RadzenRow>
						<RadzenRow>
							<RadzenText TextStyle="TextStyle.H5">0</RadzenText>
						</RadzenRow>
					</RadzenColumn>
				</RadzenCard>
				@* User Cards/Toplam Görüşme *@
				<RadzenCard Variant="Variant.Filled" Style="display:flex; align-items:center; gap:10px;">
					<RadzenColumn><RadzenImage Path="icons/TotalMeetingsIcon.svg" Style="width:50px" /></RadzenColumn>
					<RadzenColumn>
						<RadzenRow>
							<RadzenText TextStyle="TextStyle.Subtitle1">Toplam Görüşme</RadzenText>
						</RadzenRow>
						<RadzenRow>
							<RadzenText TextStyle="TextStyle.H5">0</RadzenText>
						</RadzenRow>
					</RadzenColumn>
				</RadzenCard>
				@* User Cards/Planlanmış Görüşme *@
				<RadzenCard Variant="Variant.Filled" Style="display:flex; align-items:center; gap:10px;">
					<RadzenColumn><RadzenImage Path="icons/ScheduledMeetingsIcon.png" Style="width:50px" /></RadzenColumn>
					<RadzenColumn>
						<RadzenRow>
							<RadzenText TextStyle="TextStyle.Subtitle2">Planlanmış Görüşme</RadzenText>
						</RadzenRow>
						<RadzenRow>
							<RadzenText TextStyle="TextStyle.H5">0</RadzenText>
						</RadzenRow>
					</RadzenColumn>
				</RadzenCard>
				@* User Cards/Licence *@
				<RadzenCard Variant="Variant.Filled" Style="display:flex; align-items:center; gap:10px;">
					<RadzenColumn><RadzenImage Path="icons/cash.png" Style="width:50px" /></RadzenColumn>
					<RadzenColumn>
						<RadzenRow>
							<RadzenText TextStyle="TextStyle.Subtitle2">Aylık Gelir</RadzenText>
						</RadzenRow>
						<RadzenRow>
							<RadzenText TextStyle="TextStyle.H5">0</RadzenText>
						</RadzenRow>
					</RadzenColumn>
				</RadzenCard>
			</RadzenCardGroup>
			</RadzenStack>

			@* Dashboard Middle Section *@
			<RadzenRow Gap="20px">
				@* Message Column *@
				<RadzenColumn Size="6">
					<RadzenCard Style="display:flex;flex-direction:column;gap:10px">
						<RadzenRow Style="margin-bottom:0.5rem">
							<RadzenColumn>
								<RadzenRow>
									<RadzenIcon Icon="payments" /><RadzenText TextStyle="TextStyle.DisplayH5">Son Satışlar</RadzenText>
								</RadzenRow>
							</RadzenColumn>
							<RadzenColumn Style="display:flex; justify-content:flex-end">
								<RadzenButton Text="Detayları Görüntüle" ButtonStyle="ButtonStyle.Info" Variant="Variant.Text" Size="ButtonSize.ExtraSmall" />
							</RadzenColumn>
						</RadzenRow>
						<RadzenRow Style="background:#F7F7F8; padding:0.5rem 1rem; border-radius:20px" class="rz-shadow-1">
							<RadzenColumn Size="1" Style="display:flex; align-items:center; justify-content:center"><RadzenIcon Icon="mail" /></RadzenColumn>
							<RadzenColumn Size="11">
								<RadzenRow><RadzenText TextStyle="TextStyle.Body1"><strong>Fatih Demirbaş</strong></RadzenText></RadzenRow>
								<RadzenRow><RadzenText TextStyle="TextStyle.Body2">Merhaba, ben Fatih. Nasılsınız?</RadzenText></RadzenRow>
							</RadzenColumn>
						</RadzenRow>
						<RadzenRow Style="background:#F7F7F8; padding:0.5rem 1rem; border-radius:20px" class="rz-shadow-1">
							<RadzenColumn Size="1" Style="display:flex; align-items:center; justify-content:center"><RadzenIcon Icon="mail" /></RadzenColumn>
							<RadzenColumn Size="11">
								<RadzenRow><RadzenText TextStyle="TextStyle.Body1"><strong>Güneş Adıgüzel</strong></RadzenText></RadzenRow>
								<RadzenRow><RadzenText TextStyle="TextStyle.Body2">Merhaba, ben Güneş. Nasılsınız?</RadzenText></RadzenRow>
							</RadzenColumn>
						</RadzenRow>
						<RadzenRow Style="background:#F7F7F8; padding:0.5rem 1rem; border-radius:20px" class="rz-shadow-1">
							<RadzenColumn Size="1" Style="display:flex; align-items:center; justify-content:center"><RadzenIcon Icon="mail" /></RadzenColumn>
							<RadzenColumn Size="11">
								<RadzenRow><RadzenText TextStyle="TextStyle.Body1"><strong>Ece Dirhemsiz</strong></RadzenText></RadzenRow>
								<RadzenRow><RadzenText TextStyle="TextStyle.Body2">Merhaba, ben Ece. Nasılsınız?</RadzenText></RadzenRow>
							</RadzenColumn>
						</RadzenRow>
					</RadzenCard>
				</RadzenColumn>
				@* Event Column *@
				<RadzenColumn Size="6">
					<RadzenCard Style="display:flex;flex-direction:column;gap:10px">
						<RadzenRow AlignItems="AlignItems.Center" Style="margin-bottom:1rem">
							<RadzenColumn>
								<RadzenRow AlignItems="AlignItems.Center">
									<RadzenIcon Icon="event" /><RadzenText Style="margin-bottom:0!important" TextStyle="TextStyle.DisplayH5">Görüşmeler</RadzenText>
								</RadzenRow>
							</RadzenColumn>
							<RadzenColumn Style="display:flex; justify-content:flex-end">
								<RadzenButton Text="Randevu Oluştur" ButtonStyle="ButtonStyle.Info" Variant="Variant.Text" Size="ButtonSize.ExtraSmall" />
							</RadzenColumn>
						</RadzenRow>
						<RadzenRow Style="background:#F7F7F8; padding:0.5rem 1rem; border-radius:20px" class="rz-shadow-1">
							<RadzenColumn Size="1" Style="display:flex; align-items:center; justify-content:center"><RadzenIcon Icon="calendar_month" /></RadzenColumn>
							<RadzenColumn Size="11">
								<RadzenRow><RadzenText TextStyle="TextStyle.Body1"><strong>Görüşme: Fatih Demirbaş</strong></RadzenText></RadzenRow>
								<RadzenRow><RadzenText TextStyle="TextStyle.Body2">12 Aralık Pazar, 11.00-12.00</RadzenText></RadzenRow>
							</RadzenColumn>
						</RadzenRow>
						<RadzenRow Style="background:#F7F7F8; padding:0.5rem 1rem; border-radius:20px" class="rz-shadow-1">
							<RadzenColumn Size="1" Style="display:flex; align-items:center; justify-content:center"><RadzenIcon Icon="calendar_month" /></RadzenColumn>
							<RadzenColumn Size="11">
								<RadzenRow><RadzenText TextStyle="TextStyle.Body1"><strong>Görüşme: Güneş Adıgüzel</strong></RadzenText></RadzenRow>
								<RadzenRow><RadzenText TextStyle="TextStyle.Body2">24 Aralık Cumartesi, 11.00-12.00</RadzenText></RadzenRow>
							</RadzenColumn>
						</RadzenRow>
						<RadzenRow Style="background:#F7F7F8; padding:0.5rem 1rem; border-radius:20px" class="rz-shadow-1">
							<RadzenColumn Size="1" Style="display:flex; align-items:center; justify-content:center"><RadzenIcon Icon="calendar_month" /></RadzenColumn>
							<RadzenColumn Size="11">
								<RadzenRow><RadzenText TextStyle="TextStyle.Body1"><strong>Görüşme: Ece Dirhemsiz</strong></RadzenText></RadzenRow>
								<RadzenRow><RadzenText TextStyle="TextStyle.Body2">2 Ocak Pazar, 14.00-15.00</RadzenText></RadzenRow>
							</RadzenColumn>
						</RadzenRow>
					</RadzenCard>
				</RadzenColumn>
			</RadzenRow>
		
			@* Dashboard Bottom Section *@
			<RadzenStack class="rz-my-8">
				<RadzenRow>
					<RadzenDataGrid Data=@mentorApplications @ref="mentorApplicationTable" AllowFiltering=true AllowColumnResize="true" FilterMode="FilterMode.Advanced" AllowSorting="true"
									PageSize="5" AllowPaging="true" PagerHorizontalAlign="HorizontalAlign.Center" ShowPagingSummary="true" ColumnWidth="150px">
						<HeaderTemplate>
							<RadzenText TextStyle="TextStyle.DisplayH5">Mentor Başvuruları</RadzenText>
						</HeaderTemplate>
						<EmptyTemplate>
							<p style="color: lightgrey; font-size: 24px; text-align: center; margin: 2rem;">No records to display.</p>
						</EmptyTemplate>
						<Columns>
							<RadzenDataGridColumn Property="FirstName" Title="İsim" />
							<RadzenDataGridColumn Property="LastName" Title="Soyisim" />
							<RadzenDataGridColumn Property="Email" Title="Email" />
							<RadzenDataGridColumn Property="PhoneNumber" Title="Telefon" />
							<RadzenDataGridColumn Property="LinkedinAdress" Title="Linkedin" />
							<RadzenDataGridColumn Property="CreatedDate" Title="Başvuru Tarihi" />
							<RadzenDataGridColumn Title="İşlemler">
								<Template Context="data">
									<RadzenButton Icon="check_circle" ButtonStyle="ButtonStyle.Success" Click="@(async () => await ConfirmMentor(data))" />
									<RadzenButton Icon="delete" ButtonStyle="ButtonStyle.Danger" Click="@(() => DeleteMentorApplicationPopup(data))" />
								</Template>
							</RadzenDataGridColumn>
						</Columns>
					</RadzenDataGrid>
				</RadzenRow>
			</RadzenStack>

		</RadzenStack>
	</RadzenBody>
</RadzenLayout>

@code {
	List<Mentor> mentorApplications;
	RadzenDataGrid<Mentor> mentorApplicationTable;

	protected override async Task OnInitializedAsync()
	{
		await base.OnInitializedAsync();

		mentorApplications = _mentorService.GetAll(x => x.IsConfirmed == false);
	}

	async Task ConfirmMentor(Mentor data)
	{
		data.IsConfirmed = true;
		_mentorService.Update(data);
		await mentorApplicationTable.Reload();
		NotificationService.Notify(new NotificationMessage
				{
					Severity = NotificationSeverity.Success,
					Summary = "Mentor Onaylandı",
					Duration = 4000
				});
	}

	async Task DeleteMentorApplicationPopup(Mentor data)
	{
		var result = await DialogService.OpenAsync("Lütfen Onaylayın", ds =>
		@<RadzenStack Gap="1.5rem">
			<p>Mentor başvurusunu silmek istediğinize emin misiniz?</p>
			<RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
				<RadzenStack Orientation="Orientation.Horizontal">
				<RadzenButton Text="Onayla" Click="async () => {await DeleteMentorApplication(data); ds.Close(true);}" />
					<RadzenButton Text="İptal" Click="() => ds.Close(false)" ButtonStyle="ButtonStyle.Light" />
				</RadzenStack>
			</RadzenStack>
		</RadzenStack>
	);
	}

	async Task DeleteMentorApplication(Mentor data)
	{
		mentorApplications.Remove(data);
		await mentorApplicationTable.Reload();
		_mentorService.Delete(data);
		NotificationService.Notify(new NotificationMessage
				{
					Severity = NotificationSeverity.Success,
					Summary = "Mentor Silindi",
					Duration = 4000
				});
	}
}
